# üé≠ Sistema de Roles y Aprobaci√≥n - BaileApp

## üìã Resumen

Sistema completo de solicitud y aprobaci√≥n de roles adicionales con super admin, creaci√≥n autom√°tica de perfiles y validaci√≥n integrada.

---

## üéØ Roles Disponibles

| Rol | Icono | Descripci√≥n | Tabla | Requiere Aprobaci√≥n |
|-----|-------|-------------|-------|---------------------|
| **Usuario** | üë§ | Perfil base, todos lo tienen | `profiles_user` | ‚ùå No (autom√°tico) |
| **Organizador** | üé§ | Crea y publica eventos | `profiles_organizer` | ‚úÖ S√≠ |
| **Maestro** | üéì | Ofrece clases y horarios | `profiles_teacher` | ‚úÖ S√≠ |
| **Academia** | üè´ | Administra escuela | `profiles_school` | ‚úÖ S√≠ |
| **Marca** | üè∑Ô∏è | Promociona productos | `profiles_brand` | ‚úÖ S√≠ |

---

## üèóÔ∏è Arquitectura

### **1. Tablas en Supabase:**

#### **admins**
```sql
CREATE TABLE public.admins (
  user_id uuid PRIMARY KEY,
  created_at timestamptz
);
```
- Contiene UUIDs de usuarios con permisos de administrador
- Solo admins pueden aprobar/rechazar solicitudes

#### **role_requests**
```sql
CREATE TABLE public.role_requests (
  id bigserial PRIMARY KEY,
  user_id uuid NOT NULL,
  role text CHECK (role IN ('organizador','maestro','academia','marca')),
  note text,
  status text DEFAULT 'pendiente' CHECK (status IN ('pendiente','aprobado','rechazado')),
  created_at timestamptz,
  reviewed_by uuid,
  reviewed_at timestamptz
);
```
- Almacena solicitudes de usuarios para roles adicionales
- Estados: pendiente ‚Üí aprobado/rechazado

#### **Nuevas Tablas de Perfiles:**
- `profiles_teacher` - Maestros
- `profiles_school` - Academias
- `profiles_brand` - Marcas

Todas con estructura similar:
```sql
{
  id, user_id, nombre_publico, bio, 
  ritmos[], zonas[], media[], 
  estado_aprobacion, created_at
}
```

---

### **2. RLS Policies:**

#### **role_requests:**
```sql
-- SELECT: Usuario ve las suyas, admin ve todas
USING (user_id = auth.uid() OR is_admin(auth.uid()))

-- INSERT: Usuario crea solicitudes propias
WITH CHECK (user_id = auth.uid())

-- DELETE: Usuario borra pendientes, admin borra todo
USING ((user_id = auth.uid() AND status = 'pendiente') OR is_admin(auth.uid()))

-- UPDATE: Solo admin
USING (is_admin(auth.uid()))
```

#### **Nuevos perfiles (teacher, school, brand):**
```sql
-- SELECT: Todos pueden leer
USING (true)

-- INSERT/UPDATE/DELETE: Solo el propietario
USING (user_id = auth.uid())
```

---

### **3. Funciones RPC:**

#### **is_admin(uuid)**
```sql
CREATE FUNCTION is_admin(uid uuid) RETURNS boolean
```
- Verifica si un usuario es administrador
- Usado en pol√≠ticas RLS y validaciones

#### **approve_role_request(bigint, boolean, text)**
```sql
CREATE FUNCTION approve_role_request(
  p_request_id bigint,
  p_approve boolean,
  p_note text
)
```
- Solo ejecutable por admins
- Al aprobar:
  1. Actualiza status de la solicitud
  2. Crea perfil del rol autom√°ticamente
  3. Establece estado_aprobacion = 'aprobado'
- Al rechazar:
  1. Actualiza status a 'rechazado'
  2. Guarda nota opcional

---

## üîÑ Flujo de Usuario

```
Usuario quiere ser organizador
       ‚Üì
Va a /profile/roles
       ‚Üì
RoleSelectorScreen muestra 4 cards
       ‚Üì
Usuario hace clic en "Solicitar" en "Organizador"
       ‚Üì
INSERT en role_requests con:
  - user_id
  - role: 'organizador'
  - status: 'pendiente'
       ‚Üì
Card muestra "En revisi√≥n ‚è≥"
       ‚Üì
Super Admin revisa en /admin/roles
       ‚Üì
Admin hace clic en "Aprobar"
       ‚Üì
RPC approve_role_request:
  1. UPDATE role_requests SET status='aprobado'
  2. INSERT en profiles_organizer
     - nombre_publico: 'Mi Organizaci√≥n'
     - estado_aprobacion: 'aprobado'
       ‚Üì
Usuario ve "Aprobado ‚úÖ"
Card muestra bot√≥n "Ir a mi perfil ‚Üí"
       ‚Üì
Usuario hace clic ‚Üí /profile/organizer/edit
       ‚Üì
Puede crear eventos y gestionar su perfil
```

---

## üîÑ Flujo de Admin

```
Admin va a /admin/roles
       ‚Üì
AdminRoleRequestsScreen carga solicitudes pendientes
       ‚Üì
Muestra lista con:
  - Rol solicitado
  - UUID del usuario
  - Nota (si existe)
  - Fecha de solicitud
       ‚Üì
Admin hace clic en "Aprobar" o "Rechazar"
       ‚Üì
useApproveRoleRequest ejecuta RPC
       ‚Üì
Toast de confirmaci√≥n
       ‚Üì
Lista se actualiza autom√°ticamente
```

---

## üé® Pantallas

### **1. RoleSelectorScreen** (`/profile/roles`)

**Caracter√≠sticas:**
- ‚úÖ Grid de 4 cards (organizador, maestro, academia, marca)
- ‚úÖ Cada card muestra:
  - Icono grande
  - Nombre del rol
  - Descripci√≥n
  - Badge de estado (sin solicitar/pendiente/aprobado/rechazado)
  - Bot√≥n de acci√≥n
- ‚úÖ **Estados:**
  - Sin solicitar: Bot√≥n "Solicitar acceso"
  - Pendiente: Bot√≥n deshabilitado "En revisi√≥n ‚è≥"
  - Aprobado: Link "Ir a mi perfil ‚Üí"
  - Rechazado: Advertencia + bot√≥n para volver a solicitar
- ‚úÖ Animaciones con Framer Motion
- ‚úÖ Breadcrumbs de navegaci√≥n
- ‚úÖ Link para volver al perfil

### **2. AdminRoleRequestsScreen** (`/admin/roles`)

**Caracter√≠sticas:**
- ‚úÖ Filtros por estado (pendiente/aprobado/rechazado)
- ‚úÖ Lista de solicitudes con:
  - Rol solicitado (UPPERCASE)
  - UUID del usuario (primeros 8 caracteres)
  - Nota del usuario
  - Fecha de solicitud
  - Botones de acci√≥n (solo en pendientes)
- ‚úÖ Animaciones escalonadas por √≠ndice
- ‚úÖ Estados de carga
- ‚úÖ Toast notifications
- ‚úÖ Actualizaci√≥n autom√°tica de lista

---

## üõ†Ô∏è Hooks

### **useMyRoleRequests()**
```typescript
const { data, isLoading } = useMyRoleRequests();
// data: RoleRequest[] (solicitudes del usuario actual)
```

### **useRequestRole()**
```typescript
const requestRole = useRequestRole();
await requestRole.mutateAsync({ role: 'organizador', note: 'opcional' });
```

### **useAdminRoleRequests(status?)**
```typescript
const { data } = useAdminRoleRequests('pendiente');
// data: RoleRequest[] (todas las solicitudes, filtradas por estado)
```

### **useApproveRoleRequest()**
```typescript
const approve = useApproveRoleRequest();
await approve.mutateAsync({ id: 123, approve: true, note: 'opcional' });
```

### **useIsAdmin()**
```typescript
const { data: isAdmin } = useIsAdmin();
// data: boolean (true si el usuario es admin)
```

---

## üîí Seguridad (RLS)

### **Pol√≠ticas Implementadas:**

1. **role_requests SELECT:**
   - Usuario ve solo sus solicitudes
   - Admin ve todas las solicitudes

2. **role_requests INSERT:**
   - Solo puede insertar con su propio user_id

3. **role_requests DELETE:**
   - Usuario puede borrar solo pendientes
   - Admin puede borrar cualquiera

4. **role_requests UPDATE:**
   - Solo admin puede actualizar (aprobar/rechazar)

5. **RPC approve_role_request:**
   - Solo ejecutable por admin (verificaci√≥n en funci√≥n)
   - SECURITY DEFINER para crear perfiles

---

## üìù Instrucciones de Configuraci√≥n

### **1. Ejecutar Script SQL**

En Supabase SQL Editor:
```sql
-- apps/web/SCRIPT_14_ROLE_REQUESTS_SYSTEM.sql
```

Este script crea:
- ‚úÖ Tabla `admins`
- ‚úÖ Tabla `role_requests`
- ‚úÖ Tablas `profiles_teacher`, `profiles_school`, `profiles_brand`
- ‚úÖ Funci√≥n `is_admin(uuid)`
- ‚úÖ Funci√≥n `approve_role_request(bigint, boolean, text)`
- ‚úÖ Pol√≠ticas RLS para todas las tablas

### **2. Convertir Usuario en Admin**

En Supabase SQL Editor:
```sql
-- Obtener tu UUID
SELECT id, email FROM auth.users WHERE email = 'tu-email@ejemplo.com';

-- Convertirte en admin (reemplaza el UUID)
INSERT INTO admins (user_id) 
VALUES ('uuid-que-obtuviste-arriba');
```

### **3. Verificar**

```sql
-- Ver todos los admins
SELECT a.user_id, au.email 
FROM admins a 
JOIN auth.users au ON a.user_id = au.id;

-- Ver solicitudes pendientes
SELECT * FROM role_requests 
WHERE status = 'pendiente' 
ORDER BY created_at DESC;
```

---

## üéØ Casos de Uso

### **Caso 1: Usuario Solicita Ser Organizador**

1. Usuario va a su perfil ‚Üí Click "Tipos de Perfil"
2. Ve card de "Organizador"
3. Click en "Solicitar acceso"
4. Se crea solicitud en `role_requests`
5. Card muestra "En revisi√≥n ‚è≥"
6. Espera aprobaci√≥n del admin

### **Caso 2: Admin Aprueba Solicitud**

1. Admin va a `/admin/roles`
2. Ve solicitud pendiente de "ORGANIZADOR"
3. Click en "Aprobar"
4. RPC ejecuta:
   - Actualiza solicitud a 'aprobado'
   - Crea perfil en `profiles_organizer`
5. Usuario ahora tiene acceso a perfil de organizador

### **Caso 3: Usuario Rechazado Vuelve a Intentar**

1. Usuario ve "Rechazado ‚ùå" en card
2. Puede hacer click en "Solicitar acceso" nuevamente
3. Se crea nueva solicitud
4. Ciclo se repite

---

## üîó Integraci√≥n con ProfileSwitchFab

Para integrar con el switch de roles existente:

```typescript
// En ProfileSwitchFab o donde manejes el cambio de rol:
import { useMyRoleRequests } from "../hooks/useRoleRequests";

const { data: reqs } = useMyRoleRequests();

const handleSwitchToOrganizador = () => {
  const orgApproved = reqs?.some(
    r => r.role === 'organizador' && r.status === 'aprobado'
  );
  
  if (!orgApproved) {
    showToast('Necesitas solicitar acceso como organizador', 'error');
    navigate('/profile/roles');
    return;
  }
  
  // Continuar con el switch normal
  setRole('organizador');
};
```

---

## üêõ Debugging

### **Ver solicitudes de un usuario:**
```sql
SELECT * FROM role_requests 
WHERE user_id = 'uuid-del-usuario'
ORDER BY created_at DESC;
```

### **Ver todas las solicitudes pendientes:**
```sql
SELECT 
  rr.*,
  au.email as user_email
FROM role_requests rr
JOIN auth.users au ON rr.user_id = au.id
WHERE status = 'pendiente'
ORDER BY created_at ASC;
```

### **Aprobar manualmente desde SQL:**
```sql
-- Opci√≥n 1: Usar la funci√≥n RPC (recomendado)
SELECT approve_role_request(123, true, 'Aprobado desde SQL');

-- Opci√≥n 2: Manual (NO recomendado, no crea perfil)
UPDATE role_requests 
SET status = 'aprobado', reviewed_at = NOW() 
WHERE id = 123;

-- Si usaste opci√≥n 2, crear perfil manualmente:
INSERT INTO profiles_organizer (user_id, nombre_publico, estado_aprobacion)
VALUES ('uuid-del-usuario', 'Mi Organizaci√≥n', 'aprobado');
```

---

## üìä Estados Posibles

### **Para una Solicitud:**

```
[Sin solicitar]
      ‚Üì
Usuario solicita
      ‚Üì
[Pendiente ‚è≥]
      ‚Üì
Admin revisa
      ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Aprobar    ‚îÇ   Rechazar   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚Üì              ‚Üì
[Aprobado ‚úÖ]   [Rechazado ‚ùå]
      ‚Üì              ‚Üì
Perfil creado   Puede reintentar
```

---

## üé® UI Components

### **RoleSelectorScreen:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üè† Inicio ‚Üí üë§ Perfil ‚Üí üé≠ Tipos de Perfil  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

       üé≠ Tipos de Perfil
  Elige roles adicionales para m√°s funcionalidades

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üé§          ‚îÇ ‚îÇ üéì          ‚îÇ
‚îÇ Organizador ‚îÇ ‚îÇ Maestro     ‚îÇ
‚îÇ Crea eventos‚îÇ ‚îÇ Da clases   ‚îÇ
‚îÇ              ‚îÇ ‚îÇ              ‚îÇ
‚îÇ [Aprobado ‚úÖ]‚îÇ ‚îÇ [Pendiente ‚è≥]‚îÇ
‚îÇ Ir a perfil ‚Üí‚îÇ ‚îÇ En revisi√≥n  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üè´          ‚îÇ ‚îÇ üè∑Ô∏è          ‚îÇ
‚îÇ Academia    ‚îÇ ‚îÇ Marca       ‚îÇ
‚îÇ Tu escuela  ‚îÇ ‚îÇ Tus productos‚îÇ
‚îÇ              ‚îÇ ‚îÇ              ‚îÇ
‚îÇ [Rechazado ‚ùå]‚îÇ ‚îÇ Sin solicitar‚îÇ
‚îÇ Solicitar   ‚îÇ ‚îÇ Solicitar   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

        ‚Üê Volver a mi perfil
```

### **AdminRoleRequestsScreen:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üè† Inicio ‚Üí ‚öôÔ∏è Admin ‚Üí üìã Solicitudes       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

     ‚öôÔ∏è Solicitudes de Rol
  Aprueba o rechaza solicitudes de usuarios

[‚è≥ Pendientes] [‚úÖ Aprobados] [‚ùå Rechazados]

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ORGANIZADOR                 [‚úÖ Aprobar] [‚ùå]  ‚îÇ
‚îÇ Usuario: 12345678...                          ‚îÇ
‚îÇ Nota: Quiero organizar sociales               ‚îÇ
‚îÇ Solicitado: 22/10/2024                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ MAESTRO                     [‚úÖ Aprobar] [‚ùå]  ‚îÇ
‚îÇ Usuario: 87654321...                          ‚îÇ
‚îÇ Solicitado: 21/10/2024                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ Gu√≠a de Uso

### **Para Usuarios:**

1. **Ve a tu perfil** (`/app/profile`)
2. **Modo edici√≥n** (si no est√°s)
3. **Scroll hasta abajo**
4. **Click en** "üé≠ Tipos de Perfil (Organizador, Maestro, Academia)"
5. **Selecciona** el rol que desees
6. **Click en** "Solicitar acceso"
7. **Espera** la aprobaci√≥n del admin

### **Para Admins:**

1. **Ve a** `/admin/roles`
2. **Ver√°s** solicitudes pendientes
3. **Revisa** cada solicitud
4. **Click en** "Aprobar" o "Rechazar"
5. **El perfil se crea autom√°ticamente** al aprobar

### **Convertir a Alguien en Admin:**

```sql
-- Paso 1: Obtener UUID del usuario
SELECT id, email FROM auth.users WHERE email = 'admin@ejemplo.com';

-- Paso 2: Insertar en tabla admins
INSERT INTO admins (user_id) VALUES ('uuid-del-paso-1');

-- Paso 3: Verificar
SELECT a.user_id, au.email FROM admins a 
JOIN auth.users au ON a.user_id = au.id;
```

---

## üìä Queries √ötiles

### **Ver todas las solicitudes:**
```sql
SELECT 
  rr.id,
  rr.role,
  rr.status,
  au.email,
  rr.created_at,
  rr.note
FROM role_requests rr
JOIN auth.users au ON rr.user_id = au.id
ORDER BY rr.created_at DESC;
```

### **Ver usuarios con m√∫ltiples roles:**
```sql
SELECT 
  au.email,
  EXISTS(SELECT 1 FROM profiles_organizer WHERE user_id = au.id) as es_org,
  EXISTS(SELECT 1 FROM profiles_teacher WHERE user_id = au.id) as es_maestro,
  EXISTS(SELECT 1 FROM profiles_school WHERE user_id = au.id) as es_academia,
  EXISTS(SELECT 1 FROM profiles_brand WHERE user_id = au.id) as es_marca
FROM auth.users au
LIMIT 10;
```

### **Aprobar todas las solicitudes pendientes (CUIDADO):**
```sql
-- Solo usar en desarrollo/testing
DO $$
DECLARE
  req RECORD;
BEGIN
  FOR req IN SELECT id FROM role_requests WHERE status = 'pendiente' LOOP
    PERFORM approve_role_request(req.id, true, 'Auto-aprobado');
  END LOOP;
END $$;
```

---

## ‚úÖ Checklist de Implementaci√≥n

- [x] Script SQL con tablas y RLS
- [x] Funci√≥n is_admin(uuid)
- [x] Funci√≥n approve_role_request RPC
- [x] Hook useRoleRequests con todas las mutations
- [x] Hook useIsAdmin para guards
- [x] RoleSelectorScreen con cards animados
- [x] AdminRoleRequestsScreen con filtros
- [x] Rutas en router (/profile/roles, /admin/roles)
- [x] Bot√≥n en UserProfileEditor para acceder
- [x] Toast notifications
- [x] Estados de carga
- [x] Logging para debugging
- [ ] Integraci√≥n con ProfileSwitchFab (validar roles aprobados)
- [ ] Admin guard para /admin/* routes

---

## üîÆ Pr√≥ximas Mejoras

- [ ] Guard de admin para rutas /admin/*
- [ ] Notificaciones push cuando se aprueba/rechaza
- [ ] Email autom√°tico al aprobar/rechazar
- [ ] Historial de cambios en solicitudes
- [ ] Campos adicionales en solicitud (experiencia, portafolio)
- [ ] Sistema de verificaci√≥n (documentos, referencias)
- [ ] Dashboard de admin con m√©tricas
- [ ] Roles personalizados (m√°s all√° de los 4)

---

## üéâ Resultado Final

‚úÖ **Sistema completo de roles con aprobaci√≥n**  
‚úÖ **4 tipos de perfiles adicionales**  
‚úÖ **Super admin con panel de control**  
‚úÖ **Creaci√≥n autom√°tica de perfiles al aprobar**  
‚úÖ **RLS seguro y bien configurado**  
‚úÖ **UI moderna con animaciones**  
‚úÖ **Validaci√≥n integrada con switch de roles**  

**¬°Sistema de roles 100% funcional!** üé≠‚öôÔ∏è

