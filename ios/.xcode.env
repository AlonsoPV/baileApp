# This `.xcode.env` file is versioned and is used to source the environment
# used when running script phases inside Xcode.
# To customize your local environment, you can create an `.xcode.env.local`
# file that is not versioned.

# NODE_BINARY variable contains the PATH to the node executable.
# React Native reads this file and expects NODE_BINARY to be exported.
# Using 'command -v node' ensures it works in both local and CI environments.
export NODE_BINARY="$(command -v node)"

# Fallbacks for Xcode environments that don't load shell profiles (nvm/zshrc)
# Xcode build scripts run in a minimal environment that may not have PATH set correctly
if [ -z "$NODE_BINARY" ]; then
  for CAND in \
    /opt/homebrew/bin/node \
    /usr/local/bin/node \
    /usr/bin/node \
    /bin/node
  do
    if [ -x "$CAND" ]; then
      NODE_BINARY="$CAND"
      break
    fi
  done
fi

# Optional: add common PATH locations then retry
if [ -z "$NODE_BINARY" ]; then
  export PATH="/opt/homebrew/bin:/usr/local/bin:/usr/bin:/bin:$PATH"
  NODE_BINARY="$(command -v node)"
fi

# Final validation: ensure NODE_BINARY is not empty
if [ -z "$NODE_BINARY" ]; then
  echo "ERROR: NODE_BINARY is empty. Node not found in PATH." >&2
  echo "PATH=$PATH" >&2
  exit 1
fi

# Additional validation: ensure the binary exists and is executable
if [ ! -x "$NODE_BINARY" ]; then
  echo "ERROR: NODE_BINARY is not executable: $NODE_BINARY" >&2
  exit 1
fi

export NODE_BINARY
